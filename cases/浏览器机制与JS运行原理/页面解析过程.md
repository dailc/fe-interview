# 页面解析过程

## load事件与DOMContentLoaded事件

当 onload（`DOM3级事件`） 事件触发时，页面上所有的DOM，样式表，脚本，图片，flash都已经加载完成了。

当 DOMContentLoaded 事件触发时，仅当DOM加载完成，不包括样式表，图片，flash。
(譬如如果有async加载的脚本就不一定完成)

## 知道defer和async么，它们的作用？

- async：异步加载脚本

用了它后的作用就是：

立即加载脚本，但是异步加载，也就是说页面的其它操作并不会暂停，并且只对外部脚本生效

- defer：延迟执行脚本

用了它后的作用就是：

立即下载，但延迟执行（同样异步加载），这个脚本会被等到文档完全解析和显示后再执行，并且只对外部脚本生效

- 否则，如果普通的script，下载和执行时都会阻塞文档解析

## 详解下script标签中defer和async的区别？

- async：异步加载脚本

用了它后的作用就是：

立即加载脚本，但是异步加载，也就是说页面的其它操作并不会暂停，并且只对外部脚本生效

一般设置async="async"（古老的XHTML更是严格要求）

一些注意的地方：

异步加载的脚本并不确保执行顺序（所以建议异步脚本不要再加载期间修改dom），
异步脚本一定会在load事件前执行，但是可能在DOMContentLoaded事件的前面或后面

- defer：延迟执行脚本

用了它后的作用就是：

立即下载，但延迟执行（同样异步加载），这个脚本会被等到文档完全解析和显示后再执行，并且只对外部脚本生效

一般设置defer="defer"（古老的XHTML更是严格要求）

一些注意的地方：

html5规范要求，延迟加载的执行顺序是和引入顺序一样的，而且脚本执行顺序先于DOMContentLoaded事件
（但是实际上不一定按这个顺序，而且也不一定在DOMContentLoaded事件执行-浏览器的实现问题）

按规范来说，defer应该是立即异步下载并延迟执行，
但是实际实现来说，譬如chrome中defer是和将script放到body底部一样的效果。
（相当于延迟下载了-浏览器优化的结果）

- 如果同时使用async和defer，一般表现和async一致（如chrome中的实际效果）

- 否则，如果普通的script，下载和执行时都会阻塞文档解析


一般的使用常见：

在webkit引擎下，建议的方式仍然是把<script>写在<body>底部，
如果需要使用百度谷歌分析或者谷歌分析等独立库时可以使用async属性，
若<script>标签必须写在<head>头部内可以使用defer属性，

兼容性：

async在IE<=9时不支持，其他浏览器OK；defer在IE<=9时支持但会有bug，其他浏览器OK

按mdn中的说明，这两个属性是h5中规范的（其中async明确是属于h5，defer在html4.01可能已经存在，但目前基本都是h5，所以都有这两个属性的）

## 加载远程脚本时，script标签中嵌入执行代码会怎么样？

例如

```html
<script src="xxx.jd">
alert('hello world');
</script>
```


JavaScript高级程序设计中有提到过：

带有src属性的script标签中嵌入的任何代码都会被忽略（也就是说这个标签只会去加载src，不会执行中间的代码），
所以上述的alert无效
