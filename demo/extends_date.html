<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
        <title>extends date</title>
    </head>

    <body>
        <script type="text/javascript" src="extends_date_babel.js"></script>
        <script>
            'use strict';

            /**
             * ============part1============
             * classçš„ç»§æ‰¿
             * å¯ä»¥å°è¯•ä¸‹babelæ‰“åŒ…ä¸‹çš„æƒ…å†µï¼Œ
             * ä¼šå‘ç°æ‰“åŒ…åä¼šæç¤ºthis is not a Date object
             */
            class MyDate extends Date {
                constructor() {
                    super();
                    this.abc = 1;
                }
                getTest() {
                    return this.getTime();
                }
            }

            /**
             * ============part2============
             * ç»å…¸çš„jsç»„åˆå¯„ç”Ÿç»§æ‰¿
             */
            function MyDate2() {
                this.abc = 1;

                Date.apply(this, arguments);
            }

            function extendsObj(subClass, superClass) {
                function Inner() {}

                Inner.prototype = superClass.prototype;
                subClass.prototype = new Inner();
                subClass.prototype.constructor = subClass;
            }

            extendsObj(MyDate2, Date);

            MyDate2.prototype.getTest = function getTest() {
                return this.getTime();
            };

            // éœ€è¦è€ƒè™‘polyfillæƒ…å†µ
            Object.setPrototypeOf = Object.setPrototypeOf || function(obj, proto) {
                obj.__proto__ = proto;

                return obj;
            };

            /**
             * ============part3============
             * ç”¨äº†ç‚¹æŠ€å·§çš„ç»§æ‰¿ï¼Œå®é™…ä¸Šè¿”å›çš„æ˜¯Dateå¯¹è±¡
             */
            function MyDate3() {
                // bindå±äºFunction.prototypeï¼Œæ¥æ”¶çš„å‚æ•°æ˜¯ï¼šobject, param1, params2...
                var dateInst = new(Function.prototype.bind.apply(
                    Date, [Date].concat(Array.prototype.slice.call(arguments))
                ))();

                // æ›´æ”¹åŸå‹æŒ‡å‘ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨MyDateåŸå‹ä¸Šçš„æ–¹æ³•
                // ES6æ–¹æ¡ˆä¸­ï¼Œè¿™é‡Œå°±æ˜¯[[prototype]]è¿™ä¸ªéšå¼åŸå‹å¯¹è±¡ï¼Œåœ¨æ²¡æœ‰æ ‡å‡†ä»¥å‰å°±æ˜¯__proto__
                Object.setPrototypeOf(dateInst, MyDate3.prototype);

                dateInst.abc = 1;

                return dateInst;
            }

            // åŸå‹é‡æ–°æŒ‡å›Dateï¼Œå¦åˆ™æ ¹æœ¬æ— æ³•ç®—æ˜¯ç»§æ‰¿
            Object.setPrototypeOf(MyDate3.prototype, Date.prototype);

            MyDate3.prototype.getTest = function getTest() {
                return this.getTime();
            };

            /**
             * ============part4============
             * ä»å¤–éƒ¨jsä¸­è·å–å˜é‡
             */
            var MyDateBabel = window.MyDateBabel;

            /**
             * ä»¥ä¸‹å‡†å¤‡è¾“å‡ºä¸€äº›ä¿¡æ¯
             */
            let foo = new MyDate();
            let foo2 = new MyDate2();
            let foo3 = new MyDate3();
            // è¿™ä¸ªå°±æ˜¯MyDateçš„babelæ‰“åŒ…å½¢æ€
            let foo4 = new MyDateBabel();
            
            console.log('~~~~ä»¥ä¸‹æ˜¯prototype~~~~~~~~~');
            console.log(MyDate.prototype);
            console.log(MyDate2.prototype);
            console.log(MyDate3.prototype);
            console.log(MyDateBabel.prototype);

            console.log('~~~~ä»¥ä¸‹æ˜¯newå‡ºçš„å¯¹è±¡~~~~~~~~~');
            console.log(foo);
            console.log(foo2);
            console.log(foo3);
            console.log(foo4);

            console.log('~~~~ä»¥ä¸‹æ˜¯newå‡ºçš„å¯¹è±¡çš„Object.prototype.toString.call~~~~~~~~~');
            console.log(Object.prototype.toString.call(foo));
            console.log(Object.prototype.toString.call(foo2));
            console.log(Object.prototype.toString.call(foo3));
            console.log(Object.prototype.toString.call(foo4));

            console.log('~~~~ä»¥ä¸‹æ˜¯MyDateä»¬çš„__proto__~~~~~~~~~');
            console.log(MyDate.__proto__);
            console.log(MyDate2.__proto__);
            console.log(MyDate3.__proto__);
            console.log(MyDateBabel.__proto__);

            console.log('~~~~ä»¥ä¸‹æ˜¯å¯¹è±¡çš„__proto__~~~~~~~~~');
            console.log(foo.__proto__);
            console.log(foo2.__proto__);
            console.log(foo3.__proto__);
            console.log(foo4.__proto__);

            console.log('~~~~ä»¥ä¸‹æ˜¯æ–¹æ³•çš„__proto__ä¸Functionçš„prototypeæ¯”è¾ƒ~~~~~~~~~');
            // é»˜è®¤çš„function MyDate() {}ä¹‹ç±»çš„æ„é€ å‡½æ•°æ˜¯Function
            console.log(Function.prototype === MyDate.__proto__);
            console.log(Function.prototype === MyDate2.__proto__);
            console.log(Function.prototype === MyDate3.__proto__);
            console.log(Function.prototype === MyDateBabel.__proto__);

            console.log('~~~~ä»¥ä¸‹æ˜¯æ–¹æ³•çš„__proto__ä¸Dateæ¯”è¾ƒ~~~~~~~~~');
            // é»˜è®¤çš„function MyDate() {}ä¹‹ç±»çš„æ„é€ å‡½æ•°æ˜¯Function
            // classå’Œbabelæ¨¡æ‹Ÿä¸­ï¼Œæ”¹å˜äº†éšå¼åŸå‹å¯¹è±¡ï¼ŒæŒ‡å‘äº†Date
            console.log(Date === MyDate.__proto__);
            console.log(Date === MyDate2.__proto__);
            console.log(Date === MyDate3.__proto__);
            console.log(Date === MyDateBabel.__proto__);

            console.log('~~~~ä»¥ä¸‹æ˜¯å¯¹è±¡çš„__proto__ä¸MyDateä»¬çš„prototypeæ¯”è¾ƒ~~~~~~~~~');
            // æ­£å¸¸æƒ…å†µä¸‹ï¼Œç”±æ„é€ å‡½æ•°æ„é€ çš„å¯¹è±¡ï¼Œ[[prototype]]æŒ‡å‘å…¶æ„é€ å‡½æ•°çš„prototypeå±æ€§æŒ‡å‘çš„å¯¹è±¡ï¼Œè¿™é‡Œæ‰‹åŠ¨å°†å…¶æŒ‡å‘äº†è¿›ä¸€æ­¥çš„çˆ¶çº§
            // æ‰€ä»¥ï¼Œä¸€èˆ¬ä¸å†å»ºè®®æ‰‹åŠ¨å»æ›´æ”¹__proto__
            console.log(MyDate.prototype === foo.__proto__);
            console.log(MyDate2.prototype === foo2.__proto__);
            console.log(MyDate3.prototype === foo3.__proto__);
            console.log(MyDateBabel.prototype === foo4.__proto__);
            
            console.log('~~~~ä»¥ä¸‹æ˜¯è°ƒç”¨abcå±æ€§~~~~~~~~~');
            console.log(foo.abc);
            console.log(foo2.abc);
            console.log(foo3.abc);
            console.log(foo4.abc);

            console.log('~~~~ä»¥ä¸‹æ˜¯è°ƒç”¨getTestæ–¹æ³•~~~~~~~~~');
            console.log('foo:' + foo.getTest());
            console.log('foo3:' + foo3.getTest());
            setTimeout(function() {
                // æ³¨æ„ï¼Œè¿™ä¸ªä¼šæŠ¥é”™ï¼Œå› ä¸ºä¸æ˜¯Dateå¯¹è±¡
                console.log('foo2:' + foo2.getTest());
            });
            setTimeout(function() {
                // è¿™ä¸ªä¹Ÿä¼šæŠ¥é”™
                console.log('foo4:' + foo4.getTest());
            });

            setTimeout(function() {
                // å°è¯•é»‘é­”æ³•
                console.log('~~~~å°è¯•é»‘é­”æ³•~~~~~~~~~');
                Object.defineProperty(foo2, Symbol.toStringTag, {
                    get: function() {
                        return "Date"
                    }
                });
                // ä½ ä¼šå‘ç°ï¼Œå°±ç®—æ”¹å˜äº†Object.prototype.toString.callï¼Œä»ç„¶ä¸ä¼šè¢«å½“ä½œDateå¯¹è±¡
                // åŸå› æ˜¯ğŸˆ¯åªæ”¹å˜äº†toStringçš„è¾“å‡ºï¼Œä½†æ˜¯æ²¡æœ‰æ”¹å˜å†…éƒ¨çš„[[Class]](ES6ä¸­æ˜¯internal slot)
                console.log('Object.prototype.toString.call:' + Object.prototype.toString.call(foo2));
                console.log('foo2:' + foo2.getTest());
            });

            // æ€»ç»“ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºES6 Classç»§æ‰¿å’Œ babelæ‰“åŒ…åæ¨¡æ‹Ÿçš„åŒºåˆ«
            // ES6ä¸­ï¼Œç»§æ‰¿åçš„å¯¹è±¡ï¼Œå†…éƒ¨çš„Object.prototype.toString.callè¾“å‡ºå·²ç»æ˜¯[object Date]äº†
            // è€Œbabelä¸­ï¼Œä»ç„¶æ˜¯[object Object]
            // å½“ç„¶äº†ï¼Œå°±ç®—æ”¹å˜äº†Object.prototype.toString.callï¼Œåªè¦[[Class]]ä¸æ˜¯Dateï¼Œä»ç„¶æ— æ•ˆ
            // ä¸ºä»€ä¹ˆï¼Ÿå‚è§es6çš„classç« èŠ‚ï¼Œé‡Œé¢è§„å®šäº†ç±»ç»§æ‰¿çš„è¡Œä¸º
            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes
            // https://stackoverflow.com/questions/6075231/how-to-extend-the-javascript-date-object/30882416
            // http://blog.csdn.net/github_36978270/article/details/71896444
            // http://blog.csdn.net/pcaxb/article/details/53784309
            // http://exploringjs.com/es6/ch_classes.html#sec_essentials-classes
            
        </script>
    </body>

</html>